package com.bc.calvalus.reporting.code;import com.bc.calvalus.reporting.code.reader.JobDetail;import com.bc.calvalus.reporting.code.reader.ReadJobDetail;import com.bc.calvalus.reporting.code.sender.NullProcessedMessage;import com.bc.calvalus.reporting.code.sender.ProcessedMessage;import com.bc.calvalus.reporting.code.sender.SendMessage;import com.bc.calvalus.commons.CalvalusLogger;import java.io.IOException;import java.io.InputStream;import java.util.List;import java.util.Properties;import java.util.concurrent.Executors;import java.util.concurrent.ScheduledExecutorService;import java.util.logging.Level;import java.util.logging.Logger;import java.util.stream.Collectors;import org.apache.log4j.BasicConfigurator;import static java.util.concurrent.TimeUnit.SECONDS;/** * @author muhammad.bc. */public class Launcher implements Runnable {    private static final Logger logger = CalvalusLogger.getLogger();    public Launcher() {        loadProperties("urbanTEP.properties");        int delaySeconds = Integer.parseInt(System.getProperty("submit.time.interval"));        ScheduledExecutorService scheduledExecutorService = Executors.newSingleThreadScheduledExecutor();        scheduledExecutorService.scheduleWithFixedDelay(this, 0, delaySeconds, SECONDS);    }    public static ProcessedMessage[] createEmpty() {        return new ProcessedMessage[]{new NullProcessedMessage()};    }    private static ProcessedMessage[] transformProcessedMessage(List<JobDetail> jobDetails) {        List<ProcessedMessage> collect = jobDetails.stream().map(p -> new ProcessedMessage(p))                .collect(Collectors.toList());        return collect.toArray(new ProcessedMessage[0]);    }    public static void main(String[] args) {        Launcher launcher = new Launcher();    }    @Override    public void run() {        ReadJobDetail readJobDetail = new ReadJobDetail();        List<JobDetail> jobDetail = readJobDetail.getJobDetail();        if (jobDetail.size() <= 0) {            logger.info(String.format("Job details between %s is empty %s", readJobDetail.startDateTime().toString()));            return;        }        ProcessedMessage[] processedMessage = transformProcessedMessage(jobDetail);        SendMessage sendMessage = new SendMessage(processedMessage);        sendMessage.send();    }    private void loadProperties(String name) {        try (InputStream resourceAsStream                     = this.getClass().getClassLoader().getResourceAsStream(name)) {            Properties properties = new Properties();            properties.load(resourceAsStream);            System.setProperties(properties);            BasicConfigurator.configure();            logger.info("Load property setting....");        } catch (IOException e) {            CalvalusLogger.getLogger().log(Level.SEVERE, String.format("Exception in load properties settings %s",                                                                       e.getMessage()));        }    }}